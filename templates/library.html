<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>My Library - GameSystem</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .flash { margin: 10px auto; padding: 10px; border-radius: 5px; width: 80%; }
        .flash.success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .flash.error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    </style>
</head>
<body>
    <header class="header-nav">
        <div class="logo">GameSystem</div>
        <div class="nav-links">
            <a href="{{ url_for('customer') }}"><i class="fas fa-gamepad icon"></i>Browse Games</a>
            <a href="{{ url_for('profile') }}"><i class="fas fa-user icon"></i>Profile</a>
            <a href="{{ url_for('logout') }}" onclick="return confirm('Are you sure you want to logout?')"><i class="fas fa-sign-out-alt icon"></i>Logout</a>
        </div>
    </header>
    <main class="main-content">
        <h1>My Game Library</h1>

        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="flash {{ category }}">{{ message }}</div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        {% if purchased_games %}
        <h2>Purchased Games</h2>
        <table>
            <thead>
                <tr>
                    <th>Game Title</th>
                    <th>Platform</th>
                    <th>Genre</th>
                    <th>Purchase Date</th>
                    <th>Condition</th>
                    <th>Status</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% for user_game in purchased_games %}
                <tr>
                    <td>{{ user_game.game.title if user_game.game else user_game.title }}</td>
                    <td>{{ user_game.game.platform if user_game.game else user_game.platform }}</td>
                    <td>{{ user_game.game.genre if user_game.game else user_game.genre }}</td>
                    <td>{{ user_game.purchase_date.strftime('%Y-%m-%d') }}</td>
                    <td>{{ user_game.condition.title() }}</td>
                    <td>
                        {% if user_game.listed_for_sale %}
                            Listed for Sale (${{ "%.2f"|format(user_game.sale_price) }})
                        {% else %}
                            Owned
                        {% endif %}
                    </td>
                    <td>
                        {% if not user_game.listed_for_sale %}
                            {% if user_game.game %}
                                <a href="{{ url_for('sell', user_game_id=user_game.id) }}" class="btn btn-small">Sell</a>
                                <a href="{{ url_for('rate_game', game_id=user_game.game_id) }}" class="btn btn-small">Rate</a>
                            {% else %}
                                Owned (Community)
                            {% endif %}
                        {% else %}
                            Listed
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% endif %}

        {% if created_games %}
        <h2>My Created Games</h2>
        <table>
            <thead>
                <tr>
                    <th>Image</th>
                    <th>Game Title</th>
                    <th>Platform</th>
                    <th>Genre</th>
                    <th>Status</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% for user_game in created_games %}
                <tr>
                    <td>
                        {% if user_game.suggestion and user_game.suggestion.image %}
                            <img src="static/uploads/{{ user_game.suggestion.image }}" alt="{{ user_game.title }}" style="width: 50px; height: 50px; object-fit: cover;">
                        {% else %}
                            <img src="{{ url_for('static', filename='logo.png') }}" alt="No image" style="width: 50px; height: 50px; object-fit: cover;">
                        {% endif %}
                    </td>
                    <td>{{ user_game.title }}</td>
                    <td>{{ user_game.platform }}</td>
                    <td>{{ user_game.genre }}</td>
                    <td>
                        {% if user_game.condition == 'approved' %}
                            <span class="approved">Approved</span>
                        {% elif user_game.condition == 'suggested' %}
                            <span class="pending">Pending Approval</span>
                        {% else %}
                            {{ user_game.condition.title() }}
                        {% endif %}
                    </td>
                    <td>
                        <a href="{{ url_for('edit_user_suggestion', suggestion_id=user_game.suggestion.id) }}" class="btn btn-small">Edit</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% endif %}

        {% if not purchased_games and not created_games %}
        <p>You don't own any games yet.</p>
        {% endif %}

    </main>
</body>
</html>
