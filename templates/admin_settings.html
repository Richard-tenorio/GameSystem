<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Admin Settings - GameSystem</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="{{ url_for('static', filename='toast.js') }}" defer></script>
    <style>
        .flash { margin: 10px auto; padding: 10px; border-radius: 5px; width: 80%; }
        .flash.success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .flash.error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .error-text { color: red; font-size: 14px; margin-top: -5px; margin-bottom: 10px; }
    </style>
</head>
<body>
    <header class="header-nav">
        <div class="logo">
            <img src="{{ url_for('static', filename='logo.png') }}" alt="logo.png">
            GameSystem Admin
        </div>
        <div class="nav-links">
            <a href="{{ url_for('admin') }}"><i class="fas fa-tachometer-alt icon"></i>Dashboard</a>
            {% if pending_count > 0 %}
            <a href="{{ url_for('manage_suggestions') }}" class="notification-link">
                <i class="fas fa-bell icon"></i>Suggestions
                <span class="notification-badge">{{ pending_count }}</span>
            </a>
            {% else %}
            <a href="{{ url_for('manage_suggestions') }}"><i class="fas fa-list icon"></i>Suggestions</a>
            {% endif %}
            <a href="{{ url_for('logout') }}" onclick="return confirm('Are you sure you want to logout?')"><i class="fas fa-sign-out-alt icon"></i>Logout</a>
        </div>
    </header>

    <main class="main-content">
        <h1><i class="fas fa-cog icon"></i>Admin Settings</h1>

        {% set messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="flash {{ category }}" role="alert" aria-live="assertive">{{ message }}</div>
            {% endfor %}
        {% endif %}

        <section class="section">
            <div class="card">
                <h2><i class="fas fa-key icon"></i>Change Password</h2>
                <form method="post">
                    <label for="current_password">Current Password:</label>
                    <input type="password" id="current_password" name="current_password" required>

                    <label for="new_password">New Password:</label>
                    <input type="password" id="new_password" name="new_password" required>
                    <small style="color: #666; font-size: 12px;">
                        Password must be at least 8 characters long and contain at least one uppercase letter, one lowercase letter, one digit, and one special character.
                    </small>

                    <label for="confirm_password">Confirm New Password:</label>
                    <input type="password" id="confirm_password" name="confirm_password" required>

                    <button type="submit"><i class="fas fa-save icon"></i>Update Password</button>
                </form>
            </div>
        </section>

        <section class="section">
            <div class="card">
                <h2><i class="fas fa-image icon"></i>Change Logo</h2>
                <form method="post" action="{{ url_for('change_logo') }}" enctype="multipart/form-data">
            <p>Current logo: <img src="{{ url_for('static', filename='logo.png') }}" alt="Current Logo" style="height: 40px; vertical-align: middle;"></p>

            <input type="file" name="logo" accept="image/*" required>
            <div class="error-text">Supported formats: PNG, JPG, JPEG, GIF, WebP. Recommended size: 200x200px or smaller.</div>

            <label><input type="checkbox" name="confirm_logo" required> Confirm change logo</label>

                    <button type="submit"><i class="fas fa-upload icon"></i>Update Logo</button>
                </form>
            </div>
        </section>

        <section class="section">
            <div class="card">
                <h2><i class="fas fa-cogs icon"></i>System Settings</h2>
                <form method="post" action="{{ url_for('update_system_settings') }}">
            <label for="site_title">Site Title:</label>
            <input type="text" id="site_title" name="site_title" value="GameSystem" required>

            <label for="max_topup">Maximum Top-up Amount (â‚±):</label>
            <input type="number" id="max_topup" name="max_topup" value="50000" min="1000" max="100000" required>

            <label for="default_game_quantity">Default Game Quantity:</label>
            <input type="number" id="default_game_quantity" name="default_game_quantity" value="10" min="1" max="1000" required>

            <label><input type="checkbox" name="maintenance_mode" value="1"> Enable Maintenance Mode</label>

            <button type="submit"><i class="fas fa-save icon"></i>Save Settings</button>
                </form>
            </div>
        </section>

        <section class="section">
            <div class="card">
                <h2><i class="fas fa-info-circle icon"></i>Account Information</h2>
                <p><strong>Username:</strong> {{ session['username'] }}</p>
                <p><strong>Role:</strong> Administrator</p>
                <p><strong>Last Login:</strong> Current Session</p>
            </div>
        </section>
    </main>
</body>
</html>
